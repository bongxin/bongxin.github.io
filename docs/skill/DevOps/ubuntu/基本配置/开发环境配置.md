# 开发环境配置

## 安装Java 8
现在运行以下命令来安装 OpenJDK 8 包
```sh
sudo apt install openjdk-8-jdk
```

## MySQL允许远程连接

### 修改mysql配置文件
```sh
sudo vi /etc/my.cnf # 要用sudo
```
1. 在 [mysqld] 小节下添加一行：skip-grant-tables=1
2. 重启 mysqld 服务：systemctl restart mysqld
3. 使用 root 用户登录到 mysql：mysql -u root

本地服务器访问mysql
```sh
mysql -u root -password
```
### 常用操作
```sql
show databases;

use mysql;

show tables;

select host,user from user;

```

### 设置允许远程连接（改表法）
```sql
update user set host = '%' where user = 'root';    //这个命令执行错误时可略过 
flush privileges;
select host, user from user;
quit;
```

### 设置允许远程连接（授权法）
```sql
GRANT ALL PRIVILEGES ON *.* TO 'user'@'%'IDENTIFIED BY 'userpwd' WITH GRANT OPTION;
FLUSH RIVILEGES；
```

```sql
GRANT ALL PRIVILEGES ON *.* TO 'user'@'192.168.32.220'IDENTIFIED BY 'userpwd' WITH GRANT OPTION;
FLUSH RIVILEGES；
```

## 安装Docker

### 解决pull镜像失败的问题
```
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
    "registry-mirrors": [
        "https://do.nark.eu.org",
        "https://dc.j8.work",
        "https://docker.m.daocloud.io",
        "https://dockerproxy.com",
        "https://docker.mirrors.ustc.edu.cn",
        "https://docker.nju.edu.cn"
    ]
}
```

### 下载
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker


## 安装GitLab

### Docker安装GitLab

#### 拉取Gitlab镜像
``` sh#
docker pull gitlab/gitlab-ce:latest
```
#### 运行GitLab

``` sh
docker run \
  --name gitlab \
  -p 30022:22 \
  -p 30080:80 \
  -p 32224:2224 \
  -p 38929:8929 \
  -p 30443:443 \
  --restart always \
  --health-cmd "curl --fail http://localhost || exit 1" \
  --health-interval 30s \
  --health-timeout 3s \
  --health-retries 3 \
  -d \
  gitlab/gitlab-ce:latest \
  "/assets/wrapper"
```

### Linux安装gitlab-runner
::: tip 提示
我使用的是Ubuntu手动安装deb包，用的是清华源[https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/](https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/)
:::

#### 下载安装
```
wget https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/noble/main/g/gitlab-ce/gitlab-ce_17.2.2-ce.0_amd64.deb
sudo dpkg -i gitlab-ce_17.2.2-ce.0_amd64.deb
```


#### 修改root密码

进入gitlab容器

```
sudo gitlab-rails console
```

修改root密码
```
user = User.where(username: 'root').first
user.password = 'new_password' # 将 new_password 替换为您的新密码
user.save!
```

